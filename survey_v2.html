<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이미지 비교 설문조사</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .question {
            margin: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .instruction {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .image-pair {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        .image-pair img {
            width: 200px;
            height: auto;
            border: 2px solid #000;
        }
        .submit-btn {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>

<h1>이미지 비교 설문조사</h1>
<p>"overall quality"가 더 좋은 이미지를 선택하세요.</p>

<form id="surveyForm">
    <div id="questionContainer"></div>
    <button type="button" class="submit-btn" onclick="submitSurvey()">Submit</button>
</form>

<script>
    async function loadSurveyData() {
        try {
            const response = await fetch("survey_urls.json"); // JSON 파일 경로
            const data = await response.json();
            ///////////////////////////////////////////////////////////////////////////////////////////
            // JSON 데이터에서 필요한 부분만 가져오기
            const surveyData = data["BG_cst"]["alpha"]["total"];
            
            // imagePairs 배열을 surveyData와 연결
            const NUM_PAIRS = 15;
            const imagePairs = Array.from({ length: surveyData.length }, (_, index) => ({ 
                // surveyData.length 출력
                print: surveyData.length,


                img1: surveyData[index]["modelA_path"], 
                img2: surveyData[index]["modelB_path"], 
                img3: surveyData[index]["org_img_path"], 
                instruction: surveyData[index]["instruction"]
            }));

            // 질문을 생성하는 함수 호출
            generateQuestions(imagePairs);
        } catch (error) {
            console.error("JSON 파일을 불러오는 중 오류 발생:", error);
        }
    }

    // 질문 생성 함수
    function generateQuestions(imagePairs) {
        const questionContainer = document.getElementById("questionContainer");

        imagePairs.forEach((pair, index) => {
            const questionDiv = document.createElement("div");
            questionDiv.className = "question";

            // 지침 텍스트 추가
            const instructionText = document.createElement("p");
            instructionText.className = "instruction";
            instructionText.textContent = pair.instruction;
            questionDiv.appendChild(instructionText);

            // 기준 이미지 추가
            const referenceImage = document.createElement("img");
            referenceImage.src = pair.img3;
            referenceImage.alt = "기준 이미지";
            referenceImage.style.border = "2px dashed #000";
            questionDiv.appendChild(referenceImage);

            // 이미지 쌍 추가
            const imagePairDiv = document.createElement("div");
            imagePairDiv.className = "image-pair";

            const label1 = document.createElement("label");
            const radio1 = document.createElement("input");
            radio1.type = "radio";
            radio1.name = `question${index + 1}`;
            radio1.value = "modelA";
            const img1 = document.createElement("img");
            img1.src = pair.img1;
            img1.alt = `Model A Image ${index + 1}`;
            label1.appendChild(radio1);
            label1.appendChild(img1);

            const label2 = document.createElement("label");
            const radio2 = document.createElement("input");
            radio2.type = "radio";
            radio2.name = `question${index + 1}`;
            radio2.value = "modelB";
            const img2 = document.createElement("img");
            img2.src = pair.img2;
            img2.alt = `Model B Image ${index + 1}`;
            label2.appendChild(radio2);
            label2.appendChild(img2);

            imagePairDiv.appendChild(label1);
            imagePairDiv.appendChild(label2);

            questionDiv.appendChild(imagePairDiv);
            questionContainer.appendChild(questionDiv);
        });
    }

    // 설문 제출 함수
    function submitSurvey() {
        const responses = {};

        const questionElements = document.querySelectorAll("#questionContainer .question");
        questionElements.forEach((question, index) => {
            const selectedOption = question.querySelector(`input[name="question${index + 1}"]:checked`);
            if (selectedOption) {
                responses[`question${index + 1}`] = selectedOption.value;
            }
        });

        console.log("응답 데이터:", responses);

        fetch("http://localhost:5000/save-survey", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(responses)
        })
        .then(response => response.json())
        .then(data => {
            console.log("설문 제출 성공:", data);
            alert("설문이 성공적으로 제출되었습니다.");
        })
        .catch(error => {
            console.error("설문 제출 오류:", error);
            alert("설문 제출에 실패했습니다. 오류 원인: " + error.message);
        });
    }

    // 페이지 로드 시 JSON 파일을 로드하여 질문 생성
    window.onload = loadSurveyData;
</script>

</body>
</html>
